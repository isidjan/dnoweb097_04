<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>¡Clase 4!</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
    </head>
    <body>
        <div class="container">
            <div div="row">
                <div div="col">
                    <h1 class="mt-5 mb-4">Sietes por años:</h1>
                    <h2 class="my-5"><i>Total por año</i></h2>

                    <table class="table table-striped">
                        <thead>
                        <tr>
                            <th>Año</th>
                            <th>Sietes</th>
                        </tr>
                    </thead>
                        <tr>
                            <td>2010</td>
                            <td id="diez"></td>
                            <td></td>
                        </tr>

                        <tr>
                            <td>2011</td>
                            <td id="once"></td>
                            <td></td>
                        </tr>

                        <tr>
                            <td>2012</td>
                            <td id="doce"></td>
                            <td></td>
                        </tr>

                        <tr>
                            <td>2013</td>
                            <td id="trece"></td>
                            <td></td>
                        </tr>

                        <tr>
                            <td>2014</td>
                            <td id="catorce"></td>
                            <td></td>
                        </tr>

                        <tr>
                            <td>2015</td>
                            <td id="quince"></td>
                            <td></td>
                        </tr>

                        <tr>
                            <td>2016</td>
                            <td id="dieciseis"></td>
                            <td></td>
                        </tr>

                        <tr>
                            <td>2017</td>
                            <td id="diecisiete"></td>
                            <td></td>
                        </tr>

                        <tr>
                            <td>2018</td>
                            <td id="dieciocho"></td>
                            <td></td>
                        </tr>

                        <tr>
                            <td>2019</td>
                            <td id="diecinueve"></td>
                            <td></td>
                        </tr>

                        <tr>
                            <td>2020</td>
                            <td id="veinte"></td>
                            <td></td>
                        </tr>

                        <tr>
                            <td>2021</td>
                            <td id="veintiuno"></td>
                            <td></td>
                        </tr>

                        <tr>
                            <td>2022</td>
                            <td id="veintidos"></td>
                            <td></td>
                        </tr>
                    </table>
                    <h2 class="my-5"><i>Total por Profes</i></h2>
                    <ol id="top-profesores"></ol>
                    <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Puesto</th>
                            <th>Profesor</th>
                            <th>Sietes</th>
                        </tr>
                    </thead>
                    <tbody id="top-profesores-table">
                        <!-- Aquí se insertarán los datos de los profesores -->
                    </tbody>
                </div>
            </div>
        </div>

        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"
            integrity="sha512-dfX5uYVXzyU8+KHqj8bjo7UkOdg18PaOtpa48djpNbZHwExddghZ+ZmzWT06R5v6NSk3ZUfsH6FNEDepLx9hPQ=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"
        ></script>
        <script>
            // todas las celdas
            const diez = document.querySelector("#diez");
            const once = document.querySelector("#once");
            const doce = document.querySelector("#doce");
            const trece = document.querySelector("#trece");
            const catorce = document.querySelector("#catorce");
            const quince = document.querySelector("#quince");
            const dieciseis = document.querySelector("#dieciseis");
            const diecisiete = document.querySelector("#diecisiete");
            const dieciocho = document.querySelector("#dieciocho");
            const diecinueve = document.querySelector("#diecinueve");
            const veinte = document.querySelector("#veinte");
            const veintiuno = document.querySelector("#veintiuno");
            const veintidos = document.querySelector("#veintidos");
            const topProfesores = document.querySelector("#top-profesores");
            const topProfesoresTable = document.querySelector("#top-profesores-table");

            // los raw data
            var datos;
            var profes = [];
            var profesOK = [];

            Papa.parse("https://raw.githubusercontent.com/profesorfaco/dno097-2024/main/clase-04/sietes.csv", {
                download: true,
                header: true,
                dynamicTyping: true,
                complete: function (results) {
                    datos = results.data;
                    datos.forEach((x) => {
                        if (x.year == 2010) {
                            diez.innerHTML += "★";
                        } else if (x.year == 2011) {
                            once.innerHTML += "★";
                        } else if (x.year == 2012) {
                            doce.innerHTML += "★";
                        } else if (x.year == 2013) {
                            trece.innerHTML += "★";
                        } else if (x.year == 2014) {
                            catorce.innerHTML += "★";
                        } else if (x.year == 2015) {
                            quince.innerHTML += "★";
                        } else if (x.year == 2016) {
                            dieciseis.innerHTML += "★";
                        } else if (x.year == 2017) {
                            diecisiete.innerHTML += "★";
                        } else if (x.year == 2018) {
                            dieciocho.innerHTML += "★";
                        } else if (x.year == 2019) {
                            diecinueve.innerHTML += "★";
                        } else if (x.year == 2020) {
                            veinte.innerHTML += "★";
                        } else if (x.year == 2021) {
                            veintiuno.innerHTML += "★";
                        } else {
                            veintidos.innerHTML += "★";
                        }

                let profesor = { name: x.tutor, sietes: 1 };
                var existe = false;
                profes.forEach((profeLeido) => {
                    if (profeLeido.name == x.tutor) {
                        profeLeido.sietes += 1;
                        existe = true;
                    }
                });

                if (existe == false) {
                    profes.push(profesor);
                }
            });

            // Ordenar el array profes por la cantidad de sietes en orden descendente
            profes.sort((a, b) => b.sietes - a.sietes);

            // Función para generar estrellas según la cantidad de sietes
            function generarEstrellas(cantidadSietes) {
                let estrellas = '';
                for (let i = 0; i < cantidadSietes; i++) {
                    estrellas += '★'; // Agregar una estrella por cada siete
                }
                return estrellas;
            }

            // Iterar sobre los primeros 10 elementos de profes
            profes.slice(0, 10).forEach((profesor, index) => {
                // Crear una fila en la tabla para cada profesor
                const row = document.createElement("tr");

                // Crear una celda para el puesto
                const puestoCell = document.createElement("td");
                puestoCell.textContent = index + 1; // El puesto es el índice más 1
                row.appendChild(puestoCell);

                // Crear una celda para el nombre del profesor
                const nombreCell = document.createElement("td");
                nombreCell.textContent = profesor.name;
                row.appendChild(nombreCell);

                // Crear una celda para las estrellas (representando los sietes)
                const sietesCell = document.createElement("td");
                const estrellas = generarEstrellas(profesor.sietes);
                const estrellasTexto = document.createTextNode(estrellas); // Crear nodo de texto con las estrellas
                sietesCell.appendChild(estrellasTexto); // Agregar el nodo de texto a la celda
                row.appendChild(sietesCell);

                // Agregar la fila a la tabla
                topProfesoresTable.appendChild(row);
            });
        },
    });

</script>
</body>
</html>